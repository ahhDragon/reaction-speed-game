(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var s=(r=>(r.INITIAL="INITIAL",r.WAITING="WAITING",r.READY="READY",r.RESULT="RESULT",r.EARLY_CLICK="EARLY_CLICK",r))(s||{});class d{constructor(){this.currentState=s.INITIAL,this.listeners=[],this.validTransitions=new Map([[s.INITIAL,new Set([s.WAITING])],[s.WAITING,new Set([s.EARLY_CLICK,s.READY,s.INITIAL])],[s.EARLY_CLICK,new Set([s.WAITING,s.INITIAL])],[s.READY,new Set([s.RESULT,s.INITIAL])],[s.RESULT,new Set([s.WAITING,s.INITIAL])]])}getCurrentState(){return this.currentState}setState(e){if(!this.isValidTransition(this.currentState,e))throw new Error(`Invalid state transition: ${this.currentState} -> ${e}`);this.currentState=e,this.notifyListeners(e)}onStateChange(e){this.listeners.push(e)}isValidTransition(e,t){const n=this.validTransitions.get(e);return n?n.has(t):!1}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(n){console.error("Error in state change listener:",n)}})}}class u{constructor(){this.timerId=null}getCurrentTimestamp(){return typeof performance<"u"&&performance.now?performance.now():Date.now()}setDelay(e,t){this.cancelDelay(),this.timerId=setTimeout(e,t)}cancelDelay(){this.timerId!==null&&(clearTimeout(this.timerId),this.timerId=null)}}const a={blockSize:{width:200,height:200},colors:{initial:"#e74c3c",changed:"#2ecc71"},waitingPeriodRange:{min:1e3,max:5e3}},l={godlike:180,superfast:250,excellent:320,good:400,average:500,slow:600};class h{constructor(){const e=document.getElementById("color-block"),t=document.getElementById("result-display"),n=document.getElementById("message-display");if(!e||!t||!n)throw new Error("Required DOM elements not found");this.colorBlockElement=e,this.resultDisplayElement=t,this.messageDisplayElement=n,this.initializeColorBlock()}initializeColorBlock(){const{width:e,height:t}=a.blockSize;this.colorBlockElement.style.width=`${e}px`,this.colorBlockElement.style.height=`${t}px`}renderColorBlock(e){this.colorBlockElement.style.backgroundColor=e}setInitialState(){this.colorBlockElement.classList.add("initial-state")}removeInitialState(){this.colorBlockElement.classList.remove("initial-state")}setGooseModeStyle(){this.colorBlockElement.classList.add("goose-mode")}removeGooseModeStyle(){this.colorBlockElement.classList.remove("goose-mode")}displayResult(e,t){const n=this.getFeedbackInfo(t);this.resultDisplayElement.innerHTML=`ååº”æ—¶é—´: ${e} æ¯«ç§’ - ${t}<span class="feedback-text ${n.textClass}">${n.text}</span>`,this.applyFeedbackAnimation(n.animationClass)}getFeedbackInfo(e){switch(e){case"ç¥çº§ååº”":return{text:"å¼€æŒ‚äº†å§ï¼ŸğŸ¤”",textClass:"godlike",animationClass:"feedback-godlike"};case"è¶…å¿«ååº”":return{text:"æ‰‹é€Ÿå•èº«30å¹´ï¼ğŸ’ª",textClass:"superfast",animationClass:"feedback-superfast"};case"ä¼˜ç§€ååº”":return{text:"ç¨³ï¼ğŸ‘Œ",textClass:"excellent",animationClass:"feedback-excellent"};case"è‰¯å¥½ååº”":return{text:"è¿˜ä¸é”™å˜›ï½ğŸ˜",textClass:"good",animationClass:"feedback-good"};case"è¿˜è¡Œå§":return{text:"å·®ç‚¹æ„æ€ï½ğŸ¤",textClass:"average",animationClass:"feedback-average"};case"æœ‰ç‚¹æ…¢":return{text:"æ˜¯ä¸æ˜¯æ²¡ç¡é†’ï¼ŸğŸ˜ª",textClass:"slow",animationClass:"feedback-slow"};case"ååº”è¿Ÿé’":return{text:"èœ—ç‰›éƒ½æ¯”ä½ å¿«ï¼ğŸŒ",textClass:"very-slow",animationClass:"feedback-very-slow"};default:return{text:"",textClass:"",animationClass:""}}}applyFeedbackAnimation(e){if(this.colorBlockElement.className="",e){this.colorBlockElement.classList.add(e);const t=this.getAnimationDuration(e);setTimeout(()=>{this.colorBlockElement.classList.remove(e)},t)}}getAnimationDuration(e){switch(e){case"feedback-godlike":return 1e3;case"feedback-superfast":return 1200;case"feedback-excellent":return 1200;case"feedback-good":return 1600;case"feedback-average":return 2e3;case"feedback-slow":return 2e3;case"feedback-very-slow":return 2e3;default:return 0}}displayMessage(e){this.messageDisplayElement.textContent=e}displayInstructions(){this.messageDisplayElement.textContent="ç‚¹å‡»è‰²å—å¼€å§‹æ¸¸æˆã€‚ç­‰å¾…è‰²å—å˜ç»¿åå°½å¿«ç‚¹å‡»ï¼"}clearResult(){this.resultDisplayElement.textContent=""}clearMessage(){this.messageDisplayElement.textContent=""}getColorBlockElement(){return this.colorBlockElement}showCountdownBar(){const e=document.getElementById("countdown-bar-container");e&&(e.style.display="block")}hideCountdownBar(){const e=document.getElementById("countdown-bar-container"),t=document.getElementById("countdown-bar");e&&(e.style.display="none"),t&&(t.style.width="0%")}updateCountdownBar(e){const t=document.getElementById("countdown-bar");t&&(t.style.width=`${e}%`)}}function m(r){return r<l.godlike?"ç¥çº§ååº”":r<l.superfast?"è¶…å¿«ååº”":r<l.excellent?"ä¼˜ç§€ååº”":r<l.good?"è‰¯å¥½ååº”":r<l.average?"è¿˜è¡Œå§":r<l.slow?"æœ‰ç‚¹æ…¢":"ååº”è¿Ÿé’"}class g{constructor(){this.currentRound=null,this.gooseMode=!1,this.countdownInterval=null,this.stateManager=new d,this.timerService=new u,this.uiRenderer=new h}initialize(){this.uiRenderer.renderColorBlock(a.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions(),this.uiRenderer.getColorBlockElement().addEventListener("click",()=>this.handleClick());const t=document.getElementById("goose-mode-btn");t&&t.addEventListener("click",()=>this.toggleGooseMode()),this.stateManager.onStateChange(n=>this.onStateChange(n))}toggleGooseMode(){this.gooseMode=!this.gooseMode;const e=document.getElementById("goose-mode-btn");e&&(this.gooseMode?(e.textContent="ğŸ¦¢ é€€å‡ºå¤§èƒ–é¹…æ¨¡å¼",e.classList.add("active"),this.uiRenderer.setGooseModeStyle()):(e.textContent="ğŸ¦¢ å¼€å¯å¤§èƒ–é¹…æ¨¡å¼",e.classList.remove("active"),this.uiRenderer.removeGooseModeStyle())),this.clearCountdown(),this.timerService.cancelDelay(),this.stateManager.setState(s.INITIAL),this.uiRenderer.renderColorBlock(a.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions(),this.uiRenderer.clearResult(),this.uiRenderer.clearMessage()}clearCountdown(){this.countdownInterval!==null&&(clearInterval(this.countdownInterval),this.countdownInterval=null),this.uiRenderer.hideCountdownBar()}startRound(){this.clearCountdown();let e;if(this.gooseMode)e=Math.floor(Math.random()*3001)+3e3;else{const{min:t,max:n}=a.waitingPeriodRange;e=Math.floor(Math.random()*(n-t+1))+t}this.currentRound={colorChangeTimestamp:null,clickTimestamp:null,reactionTime:null,waitingPeriod:e,currentColor:a.colors.initial},this.uiRenderer.renderColorBlock(a.colors.initial),this.uiRenderer.clearResult(),this.uiRenderer.displayMessage("ç­‰å¾…è‰²å—å˜ç»¿åå°½å¿«ç‚¹å‡»"),this.stateManager.setState(s.WAITING),this.gooseMode&&this.startCountdown(e),this.timerService.setDelay(()=>{this.clearCountdown(),this.uiRenderer.renderColorBlock(a.colors.changed),this.uiRenderer.displayMessage("å¿«ç‚¹å‡»è‰²å—ï¼ï¼"),this.currentRound&&(this.currentRound.colorChangeTimestamp=this.timerService.getCurrentTimestamp(),this.currentRound.currentColor=a.colors.changed),this.stateManager.setState(s.READY)},e)}startCountdown(e){this.uiRenderer.showCountdownBar();const t=Date.now(),n=50;this.countdownInterval=window.setInterval(()=>{const i=Date.now()-t,o=Math.min(i/e*100,100);this.uiRenderer.updateCountdownBar(o),o>=100&&this.clearCountdown()},n)}handleClick(){switch(this.stateManager.getCurrentState()){case s.INITIAL:this.uiRenderer.removeInitialState(),this.startRound();break;case s.WAITING:this.handleEarlyClick();break;case s.READY:this.handleValidClick();break;case s.RESULT:this.startRound();break;case s.EARLY_CLICK:this.timerService.cancelDelay(),this.clearCountdown(),this.stateManager.setState(s.INITIAL),this.uiRenderer.renderColorBlock(a.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions();break}}reset(){throw new Error("Method not implemented.")}handleEarlyClick(){this.timerService.cancelDelay(),this.clearCountdown(),this.stateManager.setState(s.EARLY_CLICK),this.uiRenderer.displayMessage("æå‰ç‚¹å‡»ï¼è¯·ç­‰å¾…è‰²å—å˜ç»¿åå†ç‚¹å‡»ã€‚"),this.timerService.setDelay(()=>{this.stateManager.setState(s.INITIAL),this.uiRenderer.renderColorBlock(a.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions()},2e3)}handleValidClick(){if(!this.currentRound||this.currentRound.colorChangeTimestamp===null){console.error("Invalid game round data"),this.startRound();return}this.currentRound.clickTimestamp=this.timerService.getCurrentTimestamp(),this.currentRound.reactionTime=this.currentRound.clickTimestamp-this.currentRound.colorChangeTimestamp;const e=m(this.currentRound.reactionTime);this.uiRenderer.displayResult(this.currentRound.reactionTime,e),this.stateManager.setState(s.RESULT),this.uiRenderer.displayMessage("ç‚¹å‡»è‰²å—ç»§ç»­ä¸‹ä¸€è½®")}onStateChange(e){}}document.addEventListener("DOMContentLoaded",()=>{try{new g().initialize()}catch(r){console.error("Failed to initialize game:",r),alert("æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚")}});
