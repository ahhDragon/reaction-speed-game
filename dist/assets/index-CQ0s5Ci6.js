(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var t=(n=>(n.INITIAL="INITIAL",n.WAITING="WAITING",n.READY="READY",n.RESULT="RESULT",n.EARLY_CLICK="EARLY_CLICK",n))(t||{});class u{constructor(){this.currentState=t.INITIAL,this.listeners=[],this.validTransitions=new Map([[t.INITIAL,new Set([t.WAITING])],[t.WAITING,new Set([t.EARLY_CLICK,t.READY])],[t.EARLY_CLICK,new Set([t.WAITING])],[t.READY,new Set([t.RESULT])],[t.RESULT,new Set([t.WAITING])]])}getCurrentState(){return this.currentState}setState(e){if(!this.isValidTransition(this.currentState,e))throw new Error(`Invalid state transition: ${this.currentState} -> ${e}`);this.currentState=e,this.notifyListeners(e)}onStateChange(e){this.listeners.push(e)}isValidTransition(e,r){const i=this.validTransitions.get(e);return i?i.has(r):!1}notifyListeners(e){this.listeners.forEach(r=>{try{r(e)}catch(i){console.error("Error in state change listener:",i)}})}}class d{constructor(){this.timerId=null}getCurrentTimestamp(){return typeof performance<"u"&&performance.now?performance.now():Date.now()}setDelay(e,r){this.cancelDelay(),this.timerId=setTimeout(e,r)}cancelDelay(){this.timerId!==null&&(clearTimeout(this.timerId),this.timerId=null)}}const a={blockSize:{width:200,height:200},colors:{initial:"#e74c3c",changed:"#2ecc71"},waitingPeriodRange:{min:1e3,max:5e3},roundInterval:1e3,earlyClickMessageDuration:1e3},c={excellent:200,good:300,average:400};class h{constructor(){const e=document.getElementById("color-block"),r=document.getElementById("result-display"),i=document.getElementById("message-display");if(!e||!r||!i)throw new Error("Required DOM elements not found");this.colorBlockElement=e,this.resultDisplayElement=r,this.messageDisplayElement=i,this.initializeColorBlock()}initializeColorBlock(){const{width:e,height:r}=a.blockSize;this.colorBlockElement.style.width=`${e}px`,this.colorBlockElement.style.height=`${r}px`}renderColorBlock(e){this.colorBlockElement.style.backgroundColor=e}displayResult(e,r){const i=this.getFeedbackInfo(r);this.resultDisplayElement.innerHTML=`反应时间: ${e} 毫秒 - ${r}<span class="feedback-text ${i.textClass}">${i.text}</span>`,this.applyFeedbackAnimation(i.animationClass)}getFeedbackInfo(e){switch(e){case"优秀":return{text:"太快了！",textClass:"excellent",animationClass:"feedback-excellent"};case"良好":return{text:"不错！",textClass:"good",animationClass:"feedback-good"};case"一般":return{text:"继续加油！",textClass:"average",animationClass:"feedback-average"};case"需要提高":return{text:"再试一次！",textClass:"needs-improvement",animationClass:"feedback-needs-improvement"};default:return{text:"",textClass:"",animationClass:""}}}applyFeedbackAnimation(e){if(this.colorBlockElement.className="",e){this.colorBlockElement.classList.add(e);const r=this.getAnimationDuration(e);setTimeout(()=>{this.colorBlockElement.classList.remove(e)},r)}}getAnimationDuration(e){switch(e){case"feedback-excellent":return 1200;case"feedback-good":return 1600;case"feedback-average":return 2e3;case"feedback-needs-improvement":return 2e3;default:return 0}}displayMessage(e){this.messageDisplayElement.textContent=e}displayInstructions(){this.messageDisplayElement.textContent="点击色块开始游戏。等待色块变绿后尽快点击！"}clearResult(){this.resultDisplayElement.textContent=""}clearMessage(){this.messageDisplayElement.textContent=""}getColorBlockElement(){return this.colorBlockElement}}function m(n){return n<c.excellent?"优秀":n<c.good?"良好":n<c.average?"一般":"需要提高"}class g{constructor(){this.currentRound=null,this.stateManager=new u,this.timerService=new d,this.uiRenderer=new h}initialize(){this.uiRenderer.renderColorBlock(a.colors.initial),this.uiRenderer.displayInstructions(),this.uiRenderer.getColorBlockElement().addEventListener("click",()=>this.handleClick()),this.stateManager.onStateChange(r=>this.onStateChange(r))}startRound(){const{min:e,max:r}=a.waitingPeriodRange,i=Math.floor(Math.random()*(r-e+1))+e;this.currentRound={colorChangeTimestamp:null,clickTimestamp:null,reactionTime:null,waitingPeriod:i,currentColor:a.colors.initial},this.uiRenderer.renderColorBlock(a.colors.initial),this.uiRenderer.clearResult(),this.uiRenderer.clearMessage(),this.stateManager.setState(t.WAITING),this.timerService.setDelay(()=>{this.uiRenderer.renderColorBlock(a.colors.changed),this.currentRound&&(this.currentRound.colorChangeTimestamp=this.timerService.getCurrentTimestamp(),this.currentRound.currentColor=a.colors.changed),this.stateManager.setState(t.READY)},i)}handleClick(){switch(this.stateManager.getCurrentState()){case t.INITIAL:this.startRound();break;case t.WAITING:this.handleEarlyClick();break;case t.READY:this.handleValidClick();break;case t.RESULT:case t.EARLY_CLICK:break}}reset(){throw new Error("Method not implemented.")}handleEarlyClick(){this.timerService.cancelDelay(),this.stateManager.setState(t.EARLY_CLICK),this.uiRenderer.displayMessage("提前点击！请等待色块变绿后再点击。"),this.timerService.setDelay(()=>{this.startRound()},a.earlyClickMessageDuration)}handleValidClick(){if(!this.currentRound||this.currentRound.colorChangeTimestamp===null){console.error("Invalid game round data"),this.startRound();return}this.currentRound.clickTimestamp=this.timerService.getCurrentTimestamp(),this.currentRound.reactionTime=this.currentRound.clickTimestamp-this.currentRound.colorChangeTimestamp;const e=m(this.currentRound.reactionTime);this.uiRenderer.displayResult(this.currentRound.reactionTime,e),this.stateManager.setState(t.RESULT),this.timerService.setDelay(()=>{this.startRound()},a.roundInterval)}onStateChange(e){}}document.addEventListener("DOMContentLoaded",()=>{try{new g().initialize()}catch(n){console.error("Failed to initialize game:",n),alert("游戏初始化失败，请刷新页面重试。")}});
