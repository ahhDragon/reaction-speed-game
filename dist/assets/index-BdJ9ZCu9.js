(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var n=(a=>(a.INITIAL="INITIAL",a.WAITING="WAITING",a.READY="READY",a.RESULT="RESULT",a.EARLY_CLICK="EARLY_CLICK",a))(n||{});class u{constructor(){this.currentState=n.INITIAL,this.listeners=[],this.validTransitions=new Map([[n.INITIAL,new Set([n.WAITING])],[n.WAITING,new Set([n.EARLY_CLICK,n.READY,n.INITIAL])],[n.EARLY_CLICK,new Set([n.WAITING,n.INITIAL])],[n.READY,new Set([n.RESULT,n.INITIAL])],[n.RESULT,new Set([n.WAITING,n.INITIAL])]])}getCurrentState(){return this.currentState}setState(e){if(!this.isValidTransition(this.currentState,e))throw new Error(`Invalid state transition: ${this.currentState} -> ${e}`);this.currentState=e,this.notifyListeners(e)}onStateChange(e){this.listeners.push(e)}isValidTransition(e,t){const o=this.validTransitions.get(e);return o?o.has(t):!1}notifyListeners(e){this.listeners.forEach(t=>{try{t(e)}catch(o){console.error("Error in state change listener:",o)}})}}class h{constructor(){this.timerId=null}getCurrentTimestamp(){return typeof performance<"u"&&performance.now?performance.now():Date.now()}setDelay(e,t){this.cancelDelay(),this.timerId=setTimeout(e,t)}cancelDelay(){this.timerId!==null&&(clearTimeout(this.timerId),this.timerId=null)}}const l={blockSize:{width:200,height:200},colors:{initial:"#e74c3c",changed:"#2ecc71"},waitingPeriodRange:{min:1e3,max:5e3}},c={godlike:180,superfast:250,excellent:320,good:400,average:500,slow:600};class g{constructor(){const e=document.getElementById("color-block"),t=document.getElementById("result-display"),o=document.getElementById("message-display");if(!e||!t||!o)throw new Error("Required DOM elements not found");this.colorBlockElement=e,this.resultDisplayElement=t,this.messageDisplayElement=o,this.initializeColorBlock()}initializeColorBlock(){const{width:e,height:t}=l.blockSize;this.colorBlockElement.style.width=`${e}px`,this.colorBlockElement.style.height=`${t}px`}renderColorBlock(e){this.colorBlockElement.style.backgroundColor=e}setInitialState(){this.colorBlockElement.classList.add("initial-state")}removeInitialState(){this.colorBlockElement.classList.remove("initial-state")}setGooseModeStyle(){this.colorBlockElement.classList.add("goose-mode")}removeGooseModeStyle(){this.colorBlockElement.classList.remove("goose-mode")}displayResult(e,t){const o=this.getFeedbackInfo(t);this.resultDisplayElement.innerHTML=`ååº”æ—¶é—´: ${e} æ¯«ç§’ - ${t}<span class="feedback-text ${o.textClass}">${o.text}</span>`,this.applyFeedbackAnimation(o.animationClass)}getFeedbackInfo(e){switch(e){case"ç¥é€Ÿèƒ–é¹…":return{text:'è¿™åªé¹…å¼€æŒ‚äº†ï¼<span class="goose-icon"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span>âš¡',textClass:"godlike",animationClass:"feedback-godlike"};case"é—ªç”µèƒ–é¹…":return{text:"å˜å˜å¿«ï¼ğŸ’¨",textClass:"superfast",animationClass:"feedback-superfast"};case"æ•æ·èƒ–é¹…":return{text:'èº«æ‰‹ä¸é”™ï½<span class="goose-icon"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span>âœ¨',textClass:"excellent",animationClass:"feedback-excellent"};case"ç¨³å¥èƒ–é¹…":return{text:'ç¨³ç¨³çš„é¹…ï½<span class="goose-icon"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span>',textClass:"good",animationClass:"feedback-good"};case"æ‚ é—²èƒ–é¹…":return{text:'æ…¢æ…¢æ¥å˜›ï½<span class="goose-icon"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span>ğŸ’¤',textClass:"average",animationClass:"feedback-average"};case"è¿Ÿé’èƒ–é¹…":return{text:"é¹…å›°äº†ï¼ŸğŸ˜´",textClass:"slow",animationClass:"feedback-slow"};case"ç¬¨æ‹™èƒ–é¹…":return{text:"è¿™æ˜¯ä¸€åªæ…¢é¹…ï¼ğŸŒ",textClass:"very-slow",animationClass:"feedback-very-slow"};default:return{text:"",textClass:"",animationClass:""}}}applyFeedbackAnimation(e){if(this.colorBlockElement.className="",e){this.colorBlockElement.classList.add(e);const t=this.getAnimationDuration(e);setTimeout(()=>{this.colorBlockElement.classList.remove(e)},t)}}getAnimationDuration(e){switch(e){case"feedback-godlike":return 1e3;case"feedback-superfast":return 1200;case"feedback-excellent":return 1200;case"feedback-good":return 1600;case"feedback-average":return 2e3;case"feedback-slow":return 2e3;case"feedback-very-slow":return 2e3;default:return 0}}displayMessage(e){this.messageDisplayElement.textContent=e}displayInstructions(){this.messageDisplayElement.textContent="ç‚¹å‡»è‰²å—å¼€å§‹æ¸¸æˆã€‚ç­‰å¾…è‰²å—å˜ç»¿åå°½å¿«ç‚¹å‡»ï¼"}clearResult(){this.resultDisplayElement.textContent=""}clearMessage(){this.messageDisplayElement.textContent=""}getColorBlockElement(){return this.colorBlockElement}showCountdownBar(){const e=document.getElementById("countdown-bar-container");e&&(e.style.display="block")}hideCountdownBar(){const e=document.getElementById("countdown-bar-container"),t=document.getElementById("countdown-bar");e&&(e.style.display="none"),t&&(t.style.width="0%")}updateCountdownBar(e){const t=document.getElementById("countdown-bar");t&&(t.style.width=`${e}%`)}}class m{constructor(){this.audioContext=null,this.isEnabled=!0,this.initializeAudio()}initializeAudio(){try{const e=window.AudioContext||window.webkitAudioContext;e&&(this.audioContext=new e)}catch(e){console.warn("Audio not supported:",e),this.isEnabled=!1}}async ensureAudioContext(){if(!(!this.audioContext||!this.isEnabled)&&this.audioContext.state==="suspended")try{await this.audioContext.resume()}catch(e){console.warn("Failed to resume audio context:",e)}}async playClickSound(){await this.playTone(800,.1,"sine",.3)}async playColorChangeSound(){await this.playTone(1200,.15,"triangle",.4)}async playSuccessSound(e){switch(e){case"ç¥é€Ÿèƒ–é¹…":await this.playChord([1600,2e3,2400],.3,"sine",.5);break;case"é—ªç”µèƒ–é¹…":await this.playSequence([{frequency:1200,duration:.1},{frequency:1600,duration:.2}],"triangle",.4);break;case"æ•æ·èƒ–é¹…":await this.playTone(1400,.25,"sine",.4);break;case"ç¨³å¥èƒ–é¹…":await this.playSequence([{frequency:1e3,duration:.15},{frequency:1200,duration:.15}],"triangle",.3);break;case"æ‚ é—²èƒ–é¹…":await this.playTone(800,.3,"sine",.3);break;case"è¿Ÿé’èƒ–é¹…":await this.playTone(600,.4,"triangle",.25);break;case"ç¬¨æ‹™èƒ–é¹…":await this.playSequence([{frequency:400,duration:.2},{frequency:350,duration:.3}],"sawtooth",.2);break;default:await this.playTone(1e3,.2,"sine",.3)}}async playEarlyClickSound(){await this.playSequence([{frequency:600,duration:.1},{frequency:400,duration:.2},{frequency:300,duration:.2}],"sawtooth",.3)}async playGooseModeSound(){await this.playSequence([{frequency:800,duration:.1},{frequency:600,duration:.1},{frequency:800,duration:.1},{frequency:600,duration:.1}],"square",.4)}async playTickSound(){await this.playTone(1e3,.05,"square",.2)}async playTone(e,t,o="sine",i=.3){if(await this.ensureAudioContext(),!(!this.audioContext||!this.isEnabled))try{const s=this.audioContext.createOscillator(),r=this.audioContext.createGain();s.connect(r),r.connect(this.audioContext.destination),s.frequency.setValueAtTime(e,this.audioContext.currentTime),s.type=o,r.gain.setValueAtTime(0,this.audioContext.currentTime),r.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+.01),r.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+t),s.start(this.audioContext.currentTime),s.stop(this.audioContext.currentTime+t)}catch(s){console.warn("Failed to play tone:",s)}}async playChord(e,t,o="sine",i=.3){const s=e.map(r=>this.playTone(r,t,o,i/e.length));await Promise.all(s)}async playSequence(e,t="sine",o=.3){let i=0;for(const s of e)setTimeout(()=>{this.playTone(s.frequency,s.duration,t,o)},i*1e3),i+=s.duration}setEnabled(e){this.isEnabled=e}isAudioEnabled(){return this.isEnabled&&this.audioContext!==null}}function p(a){return a<c.godlike?"ç¥é€Ÿèƒ–é¹…":a<c.superfast?"é—ªç”µèƒ–é¹…":a<c.excellent?"æ•æ·èƒ–é¹…":a<c.good?"ç¨³å¥èƒ–é¹…":a<c.average?"æ‚ é—²èƒ–é¹…":a<c.slow?"è¿Ÿé’èƒ–é¹…":"ç¬¨æ‹™èƒ–é¹…"}class y{constructor(){this.currentRound=null,this.gooseMode=!1,this.countdownInterval=null,this.stateManager=new u,this.timerService=new h,this.uiRenderer=new g,this.audioManager=new m}initialize(){this.uiRenderer.renderColorBlock(l.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions(),this.uiRenderer.getColorBlockElement().addEventListener("click",()=>this.handleClick());const t=document.getElementById("goose-mode-btn");t&&t.addEventListener("click",()=>this.toggleGooseMode());const o=document.getElementById("audio-toggle-btn");o&&o.addEventListener("click",()=>this.toggleAudio()),this.stateManager.onStateChange(i=>this.onStateChange(i))}toggleGooseMode(){this.gooseMode=!this.gooseMode,this.audioManager.playGooseModeSound();const e=document.getElementById("goose-mode-btn");e&&(this.gooseMode?(e.innerHTML='<span class="goose-icon"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span> é€€å‡ºå¤§èƒ–é¹…æ¨¡å¼',e.classList.add("active"),this.uiRenderer.setGooseModeStyle()):(e.innerHTML='<span class="goose-icon"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span> å¼€å¯å¤§èƒ–é¹…æ¨¡å¼',e.classList.remove("active"),this.uiRenderer.removeGooseModeStyle())),this.clearCountdown(),this.timerService.cancelDelay(),this.stateManager.setState(n.INITIAL),this.uiRenderer.renderColorBlock(l.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions(),this.uiRenderer.clearResult(),this.uiRenderer.clearMessage()}toggleAudio(){const e=this.audioManager.isAudioEnabled();this.audioManager.setEnabled(!e);const t=document.getElementById("audio-toggle-btn");t&&(e?(t.textContent="ğŸ”‡ éŸ³æ•ˆå…³é—­",t.classList.add("disabled")):(t.textContent="ğŸ”Š éŸ³æ•ˆå¼€å¯",t.classList.remove("disabled"),this.audioManager.playClickSound()))}clearCountdown(){this.countdownInterval!==null&&(clearInterval(this.countdownInterval),this.countdownInterval=null),this.uiRenderer.hideCountdownBar()}startRound(){this.clearCountdown();let e;if(this.gooseMode)e=Math.floor(Math.random()*3001)+3e3;else{const{min:t,max:o}=l.waitingPeriodRange;e=Math.floor(Math.random()*(o-t+1))+t}this.currentRound={colorChangeTimestamp:null,clickTimestamp:null,reactionTime:null,waitingPeriod:e,currentColor:l.colors.initial},this.uiRenderer.renderColorBlock(l.colors.initial),this.uiRenderer.clearResult(),this.uiRenderer.displayMessage("ç­‰å¾…è‰²å—å˜ç»¿åå°½å¿«ç‚¹å‡»"),this.stateManager.setState(n.WAITING),this.gooseMode&&this.startCountdown(e),this.timerService.setDelay(()=>{this.clearCountdown(),this.uiRenderer.renderColorBlock(l.colors.changed),this.audioManager.playColorChangeSound(),this.uiRenderer.displayMessage("å¿«ç‚¹å‡»è‰²å—ï¼ï¼"),this.currentRound&&(this.currentRound.colorChangeTimestamp=this.timerService.getCurrentTimestamp(),this.currentRound.currentColor=l.colors.changed),this.stateManager.setState(n.READY)},e)}startCountdown(e){this.uiRenderer.showCountdownBar();const t=Date.now(),o=50;this.countdownInterval=window.setInterval(()=>{const i=Date.now()-t,s=Math.min(i/e*100,100);this.uiRenderer.updateCountdownBar(s),s>=100&&this.clearCountdown()},o)}handleClick(){switch(this.stateManager.getCurrentState()){case n.INITIAL:this.audioManager.playClickSound(),this.uiRenderer.removeInitialState(),this.startRound();break;case n.WAITING:this.handleEarlyClick();break;case n.READY:this.handleValidClick();break;case n.RESULT:this.audioManager.playClickSound(),this.startRound();break;case n.EARLY_CLICK:this.audioManager.playClickSound(),this.timerService.cancelDelay(),this.clearCountdown(),this.stateManager.setState(n.INITIAL),this.uiRenderer.renderColorBlock(l.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions();break}}reset(){throw new Error("Method not implemented.")}handleEarlyClick(){this.audioManager.playEarlyClickSound(),this.timerService.cancelDelay(),this.clearCountdown(),this.stateManager.setState(n.EARLY_CLICK),this.uiRenderer.displayMessage("æå‰ç‚¹å‡»ï¼è¯·ç­‰å¾…è‰²å—å˜ç»¿åå†ç‚¹å‡»ã€‚"),this.timerService.setDelay(()=>{this.stateManager.setState(n.INITIAL),this.uiRenderer.renderColorBlock(l.colors.initial),this.uiRenderer.setInitialState(),this.uiRenderer.displayInstructions()},2e3)}handleValidClick(){if(!this.currentRound||this.currentRound.colorChangeTimestamp===null){console.error("Invalid game round data"),this.startRound();return}this.currentRound.clickTimestamp=this.timerService.getCurrentTimestamp(),this.currentRound.reactionTime=this.currentRound.clickTimestamp-this.currentRound.colorChangeTimestamp;const e=p(this.currentRound.reactionTime);this.audioManager.playSuccessSound(e),this.uiRenderer.displayResult(this.currentRound.reactionTime,e),this.stateManager.setState(n.RESULT),this.uiRenderer.displayMessage("ç‚¹å‡»è‰²å—ç»§ç»­ä¸‹ä¸€è½®")}onStateChange(e){}}class f{constructor(){this.currentStep=0,this.overlay=null,this.tooltip=null,this.hasCompletedTutorial=!1,this.hasCompletedTutorial=localStorage.getItem("tutorial_completed")==="true"}start(){this.hasCompletedTutorial||(this.currentStep=0,this.createOverlay(),this.showStep(0))}createOverlay(){this.overlay=document.createElement("div"),this.overlay.id="tutorial-overlay",this.overlay.className="tutorial-overlay",document.body.appendChild(this.overlay),this.tooltip=document.createElement("div"),this.tooltip.id="tutorial-tooltip",this.tooltip.className="tutorial-tooltip",document.body.appendChild(this.tooltip),this.overlay.addEventListener("click",()=>this.nextStep()),this.tooltip.addEventListener("click",()=>this.nextStep())}showStep(e){if(!this.overlay||!this.tooltip)return;const t=[{target:"#color-block",message:'<span class="goose-icon-large"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span> å˜å˜ï¼æ¬¢è¿æ¥åˆ°èƒ–é¹…æµ‹ååº”ï½ç‚¹å‡»è¿™ä¸ªè‰²å—å°±èƒ½å¼€å§‹æ¸¸æˆå•¦ï¼',position:"bottom"},{target:"#rating-guide",message:'<span class="goose-icon-large"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span> è¿™é‡Œå¯ä»¥çœ‹åˆ°è¯„åˆ†æ ‡å‡†å“¦ï½çœ‹çœ‹ä½ èƒ½æ‹¿åˆ°ä»€ä¹ˆç­‰çº§ï¼',position:"top"},{target:"#goose-mode-btn",message:'<span class="goose-icon-large"><img src="/assets/images/fatgoose_icon.png" alt="èƒ–é¹…"></span> å˜˜...è¿™é‡Œè—ç€ä¸€ä¸ªç¥ç§˜çš„ç‰¹åˆ«æ¨¡å¼ï¼Œè¦ä¸è¦è¯•è¯•ï¼Ÿ',position:"bottom"}];if(e>=t.length){this.complete();return}const o=t[e],i=document.querySelector(o.target);if(!i){this.complete();return}this.highlightElement(i),this.showTooltip(i,o.message,o.position)}highlightElement(e){if(!this.overlay)return;const t=e.getBoundingClientRect();this.overlay.style.clipPath=`polygon(
      0% 0%,
      0% 100%,
      ${t.left-10}px 100%,
      ${t.left-10}px ${t.top-10}px,
      ${t.right+10}px ${t.top-10}px,
      ${t.right+10}px ${t.bottom+10}px,
      ${t.left-10}px ${t.bottom+10}px,
      ${t.left-10}px 100%,
      100% 100%,
      100% 0%
    )`,document.querySelectorAll(".tutorial-highlight").forEach(i=>{i.classList.remove("tutorial-highlight");const s=i._tutorialClickHandler;s&&(i.removeEventListener("click",s,!0),delete i._tutorialClickHandler)}),e.classList.add("tutorial-highlight");const o=i=>{i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),this.nextStep()};e.addEventListener("click",o,!0),e._tutorialClickHandler=o}showTooltip(e,t,o){if(!this.tooltip)return;this.tooltip.innerHTML=`
      <div class="tutorial-tooltip-content">
        ${t}
      </div>
    `;const i=e.getBoundingClientRect(),s=this.tooltip.getBoundingClientRect();let r,d;o==="bottom"?(r=i.bottom+20,d=i.left+i.width/2-s.width/2):(r=i.top-s.height-20,d=i.left+i.width/2-s.width/2),d=Math.max(10,Math.min(d,window.innerWidth-s.width-10)),this.tooltip.style.top=`${r}px`,this.tooltip.style.left=`${d}px`,this.tooltip.style.opacity="1",this.tooltip.style.transform="translateY(0)"}nextStep(){this.currentStep++,this.showStep(this.currentStep)}complete(){this.overlay&&(this.overlay.remove(),this.overlay=null),this.tooltip&&(this.tooltip.remove(),this.tooltip=null),document.querySelectorAll(".tutorial-highlight").forEach(e=>{e.classList.remove("tutorial-highlight");const t=e._tutorialClickHandler;t&&(e.removeEventListener("click",t,!0),delete e._tutorialClickHandler)}),localStorage.setItem("tutorial_completed","true"),this.hasCompletedTutorial=!0}reset(){localStorage.removeItem("tutorial_completed"),this.hasCompletedTutorial=!1}}document.addEventListener("DOMContentLoaded",()=>{try{new y().initialize();const e=new f;setTimeout(()=>{e.start()},500),window.resetTutorial=()=>{e.reset(),window.location.reload()}}catch(a){console.error("Failed to initialize game:",a),alert("æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ã€‚")}});
